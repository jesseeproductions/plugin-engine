var pngx_repeatable=pngx_repeatable||{};!function(e,t){e.fn.repeatable_fields=function(t){function a(t){e(o.wrapper,t).each(function(t,n){var i=this,p=e(i).children(o.container);e(p).children(o.template).hide().find(":input").each(function(){e(this).prop("disabled",!0)});var d=e(p).children(o.row).filter(function(){return!e(this).hasClass(o.template.replace(".",""))}).length;if(e(p).attr("data-rf-row-count",d),e(i).on("click",o.add,function(t){t.stopImmediatePropagation();var n=e(e(p).children(o.template).clone().removeClass(o.template.replace(".",""))[0].outerHTML);e(n).find(":input").each(function(){e(this).prop("disabled",!1)}),"function"==typeof o.before_add&&o.before_add(p);var i=e(n).show().appendTo(p);"function"==typeof o.after_add&&o.after_add(p,i,r),a(i)}),e(i).on("click",o.remove,function(t){t.stopImmediatePropagation();var a=e(this).parents(o.row).first();"function"==typeof o.before_remove&&o.before_remove(p,a),a.remove(),"function"==typeof o.after_remove&&o.after_remove(p)}),o.is_sortable===!0&&"undefined"!=typeof e.ui&&"undefined"!=typeof e.ui.sortable){var l=null!==o.sortable_options?o.sortable_options:{};l.handle=o.move,e(i).find(o.container).sortable(l)}})}function r(t,a){var r=e(t).attr("data-rf-row-count");r++,e("*",a).each(function(){e.each(this.attributes,function(e,t){this.value=this.value.replace(o.row_count_placeholder,r-1)})}),e(t).attr("data-rf-row-count",r)}var n={wrapper:".pngx-wrapper",container:".pngx-repeater-container",row:".repeater-item",add:".add-repeater",remove:".remove-repeater",move:".repeater-sort",template:".repeater-template",is_sortable:!0,before_add:null,after_add:r,before_remove:null,after_remove:null,sortable_options:null,row_count_placeholder:"{{row-count-placeholder}}"},o=e.extend({},n,t);a(this)},t.init=function(){e(document).on("change",".repeater-item select, .repeater-item input, .repeater-item textarea",function(a){console.log("change2",e(this).parent(".repeater-item").find(".pngx-post-id").data());var r=e(this).parent(".repeater-item"),n=e(this).parent(".repeater-item").find(".pngx-post-id").val(),o=e(this).parent(".repeater-item").find(".pngx-post-id").data("postType"),i=e(this).parent(".repeater-item").find(".pngx-post-id").data("defaultTitle"),p=e(this).val(),d=e(this).attr("id"),l=e(this).data("postTitle");t.ajax_menu_item(r,n,o,i,p,d,l)})},t.ajax_menu_item=function(t,a,r,n,o,i,p){e.ajax({url:pngx_repeatable.ajaxurl,type:"post",cache:!1,dataType:"json",data:{nonce:pngx_repeatable.nonce,post_id:a,post_type:r,post_title_default:n,field_value:o,field_name:i,title_field:p,action:"pngx_repeatable"},success:function(e){e.success&&("post"===e.data.type&&e.data.ID&&(console.log("post",e.data.type,e.data.ID),t.find(".pngx-post-id").val(e.data.ID)),"meta"===e.data.type&&console.log("meta",e.data.type,e.data.ID))}})},e(function(){t.init()})}(jQuery,pngx_repeatable);